/* adapted from https://github.com/hughsk/png-chunks-extract (MIT license) and https://github.com/SheetJS/js-crc32 (Apache 2.0) (C) 2014-present SheetJS -- http://sheetjs.com https://github.com/alexhorn/uint8array-base64 (Public Domain) */
window.rewrite_pHYs_chunk=function(r,e,n,o){const t=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"];function a(r){let e=new Array(Math.ceil(4*r.length/3));for(let n=0;n<r.length;n+=3){const o=r[n],a=r[n+1],i=r[n+2];r[n+3];if(e[4*n/3]=t[o>>>2],e[4*n/3+1]=t[o<<4&63|(a||0)>>>4],!(n+1<r.length))return e.join("")+"==";if(e[4*n/3+2]=t[a<<2&63|(i||0)>>>6],!(n+2<r.length))return e.join("")+"=";e[4*n/3+3]=t[63&i]}return e.join("")}var i;!function(r){function e(){for(var r=0,e=new Array(256),n=0;256!=n;++n)r=1&(r=1&(r=1&(r=1&(r=1&(r=1&(r=1&(r=1&(r=n)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1)?-306674912^r>>>1:r>>>1,e[n]=r;return"undefined"!=typeof Int32Array?new Int32Array(e):e}r.version="1.1.1";var n=e();function o(r,e){for(var o=-1^e,t=r.length-1,a=0;a<t;)o=(o=o>>>8^n[255&(o^r.charCodeAt(a++))])>>>8^n[255&(o^r.charCodeAt(a++))];return a===t&&(o=o>>>8^n[255&(o^r.charCodeAt(a))]),-1^o}function t(r,e){if(r.length>1e4)return a(r,e);for(var o=-1^e,t=r.length-3,i=0;i<t;)o=(o=(o=(o=o>>>8^n[255&(o^r[i++])])>>>8^n[255&(o^r[i++])])>>>8^n[255&(o^r[i++])])>>>8^n[255&(o^r[i++])];for(;i<t+3;)o=o>>>8^n[255&(o^r[i++])];return-1^o}function a(r,e){for(var o=-1^e,t=r.length-7,a=0;a<t;)o=(o=(o=(o=(o=(o=(o=(o=o>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])])>>>8^n[255&(o^r[a++])];for(;a<t+7;)o=o>>>8^n[255&(o^r[a++])];return-1^o}function i(r,e){for(var o,t,a=-1^e,i=0,f=r.length;i<f;)(o=r.charCodeAt(i++))<128?a=a>>>8^n[255&(a^o)]:o<2048?a=(a=a>>>8^n[255&(a^(192|o>>6&31))])>>>8^n[255&(a^(128|63&o))]:o>=55296&&o<57344?(o=64+(1023&o),t=1023&r.charCodeAt(i++),a=(a=(a=(a=a>>>8^n[255&(a^(240|o>>8&7))])>>>8^n[255&(a^(128|o>>2&63))])>>>8^n[255&(a^(128|t>>6&15|(3&o)<<4))])>>>8^n[255&(a^(128|63&t))]):a=(a=(a=a>>>8^n[255&(a^(224|o>>12&15))])>>>8^n[255&(a^(128|o>>6&63))])>>>8^n[255&(a^(128|63&o))];return-1^a}r.table=n,r.bstr=o,r.buf=t,r.str=i}(i={});var f=new Uint8Array(4),h=new Int32Array(f.buffer),l=new Uint32Array(f.buffer);if(137!==r[0]||80!==r[1]||78!==r[2]||71!==r[3]||13!==r[4]||10!==r[5]||26!==r[6]||10!==r[7])throw new Error("Invalid .png file header: possibly caused by DOS-Unix line ending conversion?");for(var c=8;c<r.length;){f[3]=r[c++],f[2]=r[c++],f[1]=r[c++],f[0]=r[c++];var u=l[0]+4,d=new Uint8Array(u);d[0]=r[c++],d[1]=r[c++],d[2]=r[c++],d[3]=r[c++];var g=String.fromCharCode(d[0])+String.fromCharCode(d[1])+String.fromCharCode(d[2])+String.fromCharCode(d[3]);console.log("chunk found "+g+", length = "+(u-4));for(var s=c,A=4;A<u;A++)d[A]=r[c++];var C=c;f[3]=r[c++],f[2]=r[c++],f[1]=r[c++],f[0]=r[c++];var v=h[0],w=i.buf(d);if(w!==v)throw new Error("CRC values for "+g+" header do not match, PNG file is likely corrupted");if(console.log("CRCs match! "+w+" "+v+" "+d.length),"IDAT"==g){s-=8;var y=r.length,p=new Uint8Array(y+21);for(A=0;A<s;A++)p[A]=r[A];for(A=s;A<y;A++)p[A+21]=r[A];var b=new Uint8Array(13);A=0;h[0]=9,p[s++]=f[3],p[s++]=f[2],p[s++]=f[1],p[s++]=f[0],b[A++]=p[s++]="p".charCodeAt(0),b[A++]=p[s++]="H".charCodeAt(0),b[A++]=p[s++]="Y".charCodeAt(0),b[A++]=p[s++]="s".charCodeAt(0),l[0]=e,b[A++]=p[s++]=f[3],b[A++]=p[s++]=f[2],b[A++]=p[s++]=f[1],b[A++]=p[s++]=f[0],l[0]=n,b[A++]=p[s++]=f[3],b[A++]=p[s++]=f[2],b[A++]=p[s++]=f[1],b[A++]=p[s++]=f[0],b[A++]=p[s++]=1;var m=i.buf(b);return h[0]=m,p[s++]=f[3],p[s++]=f[2],p[s++]=f[1],p[s++]=f[0],o?a(p):p}if("pHYs"==g){console.log("pHYs chunk found, rewriting!!!!!!!!!!!!!"),f[3]=r[s],f[2]=r[s+1],f[1]=r[s+2],f[0]=r[s+3],console.log("pixels per metre x ="+l[0]),f[3]=r[s+4],f[2]=r[s+5],f[1]=r[s+6],f[0]=r[s+7],console.log("pixels per metre y ="+l[0]),console.log("unit (1=m) ="+r[s+8]);A=0;(b=new Uint8Array(13))[A++]="p".charCodeAt(0),b[A++]="H".charCodeAt(0),b[A++]="Y".charCodeAt(0),b[A++]="s".charCodeAt(0),l[0]=e,b[A++]=r[s++]=f[3],b[A++]=r[s++]=f[2],b[A++]=r[s++]=f[1],b[A++]=r[s++]=f[0],l[0]=n,b[A++]=r[s++]=f[3],b[A++]=r[s++]=f[2],b[A++]=r[s++]=f[1],b[A++]=r[s++]=f[0],b[A++]=r[s++]=1;m=i.buf(b);return h[0]=m,r[C++]=f[3],r[C++]=f[2],r[C++]=f[1],r[C++]=f[0],o?a(r):r}}throw new Error(".png file ended prematurely: no IEND or pHYs header was found")};